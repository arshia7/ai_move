<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÙÙ„ÙˆÚ†Ø§Ø±Øª Ø¹ÛŒØ¨â€ŒÛŒØ§Ø¨ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ (Ù†Ø³Ø®Ù‡ Ú¯ÛŒØªâ€ŒÙ‡Ø§Ø¨)</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4f46e5; /* indigo-600 */
            --primary-hover: #4338ca; /* indigo-700 */
            --secondary-color: #10b981; /* emerald-500 */
            --secondary-hover: #059669; /* emerald-600 */
            --danger-color: #ef4444; /* red-500 */
            --danger-hover: #dc2626; /* red-600 */
            --light-gray: #f8fafc;
            --medium-gray: #e5e7eb;
            --dark-gray: #334155;
        }
        /* General Body and Layout Styles */
        body {
            font-family: 'Vazirmatn', sans-serif;
            background-color: #f1f5f9;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 1rem;
            margin: 0;
        }
        /* Card Container Style */
        .card {
            background-color: white;
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            transition: all 0.3s ease-in-out;
            max-width: 500px;
            width: 90%;
            text-align: center;
            position: relative;
        }
        /* Button Styles */
        .btn {
            border-radius: 0.5rem;
            padding: 0.75rem 1.5rem;
            font-weight: 700;
            transition: all 0.2s ease;
            cursor: pointer;
            border: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .btn-yes { background-color: var(--secondary-color); color: white; }
        .btn-yes:hover { background-color: var(--secondary-hover); }
        .btn-no { background-color: var(--danger-color); color: white; }
        .btn-no:hover { background-color: var(--danger-hover); }
        .btn-restart { background-color: #3b82f6; color: white; }
        .btn-restart:hover { background-color: #2563eb; }
        .btn-gemini { background-color: var(--primary-color); color: white; }
        .btn-gemini:hover { background-color: var(--primary-hover); }
        .btn-gemini:disabled { background-color: #a5b4fc; cursor: not-allowed; }
        
        /* Result Card Styles */
        .result-card { 
            border-right: 5px solid; 
            padding: 1rem;
            background-color: var(--light-gray);
            margin-bottom: 1rem;
            text-align: right;
        }
        .diagnosis { border-color: #f97316; }
        .solution { border-color: var(--secondary-color); }
        .solution ul { list-style-type: disc; padding-right: 1.5rem; margin-top: 0.5rem; }
        
        /* Gemini AI Section */
        .gemini-section {
            border-top: 1px solid var(--medium-gray);
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            text-align: right;
        }
        .gemini-title { color: var(--primary-color); font-weight: 700; margin-bottom: 0.75rem; font-size: 1.125rem; }
        .input-field { width: 100%; padding: 0.5rem 0.75rem; border-radius: 0.5rem; border: 1px solid var(--medium-gray); margin-bottom: 1rem; box-sizing: border-box; }
        #gemini-result { background-color: #f3f4f6; border-radius: 0.5rem; padding: 1rem; margin-top: 1rem; white-space: pre-wrap; }
        #gemini-result ul { list-style-type: none; padding-right: 0; }
        #gemini-result li { display: flex; align-items: center; margin-bottom: 0.5rem; }
        #gemini-result input[type="checkbox"] { margin-left: 0.75rem; width: 1.25rem; height: 1.25rem; cursor: pointer; }

        /* API Key Modal */
        #api-key-modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0; top: 0;
            width: 100%; height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: center;
        }
        #api-key-modal .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 1rem;
            max-width: 500px;
            width: 90%;
            text-align: right;
        }
        #api-key-modal .close-btn {
            color: #aaa;
            float: left; /* For LTR close button */
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
    </style>
</head>
<body>

    <div id="flowchart-container" class="card">
        <!-- Main content is injected here -->
    </div>

    <!-- API Key Modal Structure -->
    <div id="api-key-modal">
        <div class="modal-content">
            <span class="close-btn" onclick="toggleApiKeyModal(false)">&times;</span>
            <h3 class="gemini-title">ØªÙ†Ø¸ÛŒÙ… Ú©Ù„ÛŒØ¯ API Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Gemini</h3>
            <p style="margin-bottom: 1rem;">Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù‚Ø§Ø¨Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ØŒ Ø¨Ù‡ ÛŒÚ© Ú©Ù„ÛŒØ¯ API Ø§Ø² Google AI Studio Ù†ÛŒØ§Ø² Ø¯Ø§Ø±ÛŒØ¯. Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¢Ù† Ø±Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ø±Ø§ÛŒÚ¯Ø§Ù† Ø§Ø² <a href="https://aistudio.google.com/app/apikey" target="_blank" style="color: var(--primary-color);">Ø§ÛŒÙ†Ø¬Ø§</a> Ø¯Ø±ÛŒØ§ÙØª Ú©Ù†ÛŒØ¯.</p>
            <input type="password" id="api-key-input" class="input-field" placeholder="Ú©Ù„ÛŒØ¯ API Ø®ÙˆØ¯ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯...">
            <button class="btn btn-gemini" onclick="saveApiKey()">Ø°Ø®ÛŒØ±Ù‡ Ú©Ù„ÛŒØ¯</button>
        </div>
    </div>

    <script>
        // --- DATA STRUCTURE FOR THE FLOWCHART ---
        const flowchart = {
            start: { type: 'question', text: 'Ø¢ÛŒØ§ ØªØ¹Ø±ÛŒÙ ØªØ³Ú© Ø§Ø² Ù†Ø¸Ø± Ø®ÙˆØ¯Ù… ÙˆØ§Ø¶Ø­ Ùˆ Ø´ÙØ§Ù Ø§Ø³ØªØŸ', yes: 'q_energy', no: 'r_unclear_task' },
            r_unclear_task: { type: 'result', diagnosis: 'ØªØ´Ø®ÛŒØµ: ØªØ¹Ø±ÛŒÙ Ù†Ø§Ù…Ø´Ø®Øµ ÛŒØ§ Ø¨Ø²Ø±Ú¯ÛŒ Ø¨ÛŒØ´ Ø§Ø² Ø­Ø¯ ØªØ³Ú©.', solution: 'Ø±Ø§Ù‡Ú©Ø§Ø±: ØªØ³Ú© Ø±Ø§ Ø¨Ù‡ Ù…Ø±Ø§Ø­Ù„ Ú©ÙˆÚ†Ú©â€ŒØªØ± Ø¨Ø´Ú©Ù†. Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§Ø² Ø§Ø¨Ø²Ø§Ø± Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø²ÛŒØ± Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ú©Ø§Ø± Ú©Ù…Ú© Ø¨Ú¯ÛŒØ±ÛŒØ¯.', gemini_enabled: true, gemini_type: 'breakdown' },
            q_energy: { type: 'question', text: 'Ø¢ÛŒØ§ Ø§Ø² Ù†Ø¸Ø± ÙÛŒØ²ÛŒÚ©ÛŒ Ùˆ Ø°Ù‡Ù†ÛŒ Ø§Ù†Ø±Ú˜ÛŒ Ú©Ø§ÙÛŒ Ø¯Ø§Ø±Ù…ØŸ', yes: 'q_boring', no: 'r_no_energy' },
            r_no_energy: { type: 'result', diagnosis: 'ØªØ´Ø®ÛŒØµ: ØªØ®Ù„ÛŒÙ‡ Ø§Ù†Ø±Ú˜ÛŒ ÛŒØ§ Ø®Ø³ØªÚ¯ÛŒ Ø°Ù‡Ù†ÛŒ.', solution: 'Ø±Ø§Ù‡Ú©Ø§Ø±: Ù†ÛŒØ§Ø²Ù‡Ø§ÛŒ Ø§Ø³Ø§Ø³ÛŒ Ø¨Ø¯Ù† Ùˆ Ø°Ù‡Ù† Ø®ÙˆØ¯ Ø±Ø§ Ø¯Ø± Ø§ÙˆÙ„ÙˆÛŒØª Ù‚Ø±Ø§Ø± Ø¯Ù‡ÛŒØ¯. Ø§Ø³ØªØ±Ø§Ø­Øª Ú©Ù†ÛŒØ¯ØŒ ØºØ°Ø§ÛŒ Ø³Ø§Ù„Ù… Ø¨Ø®ÙˆØ±ÛŒØ¯ ÛŒØ§ Ú†Ù†Ø¯ Ø¯Ù‚ÛŒÙ‚Ù‡ Ù‚Ø¯Ù… Ø¨Ø²Ù†ÛŒØ¯.' },
            q_boring: { type: 'question', text: 'Ø¢ÛŒØ§ Ø§ÛŒÙ† Ú©Ø§Ø± Ø¨Ù‡ Ù†Ø¸Ø±Ù… Ú©Ø³Ù„â€ŒÚ©Ù†Ù†Ø¯Ù‡ Ùˆ Ø¨ÛŒâ€ŒØ§Ù‡Ù…ÛŒØª Ù…ÛŒâ€ŒØ¢ÛŒØ¯ØŸ', yes: 'r_disconnected', no: 'q_fear' },
            r_disconnected: { type: 'result', diagnosis: 'ØªØ´Ø®ÛŒØµ: Ù‚Ø·Ø¹ Ø§Ø±ØªØ¨Ø§Ø· ØªØ³Ú© Ø¨Ø§ Â«Ú†Ø±Ø§ÛŒÛŒÂ» Ø§ØµÙ„ÛŒ.', solution: 'Ø±Ø§Ù‡Ú©Ø§Ø±: Ø¨ÛŒÙ† Ø§ÛŒÙ† Ú©Ø§Ø± Ùˆ Ù‡Ø¯Ù Ø¨Ø²Ø±Ú¯â€ŒØªØ±ØªØ§Ù† Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø±Ù‚Ø±Ø§Ø± Ú©Ù†ÛŒØ¯. Ø§Ø² Ø§Ø¨Ø²Ø§Ø± Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø²ÛŒØ± Ø¨Ø±Ø§ÛŒ ÛŒØ§ÙØªÙ† Ø§Ù†Ú¯ÛŒØ²Ù‡ Ú©Ù…Ú© Ø¨Ú¯ÛŒØ±ÛŒØ¯.', gemini_enabled: true, gemini_type: 'connect_why' },
            q_fear: { type: 'question', text: 'Ø¢ÛŒØ§ ØªØ±Ø³ Ø§Ø² Ø´Ú©Ø³Øª ÛŒØ§ Ú©Ù…Ø§Ù„â€ŒÚ¯Ø±Ø§ÛŒÛŒØŒ Ù…Ø§Ù†Ø¹ Ø´Ø±ÙˆØ¹ Ù…Ù† Ø´Ø¯Ù‡ Ø§Ø³ØªØŸ', yes: 'r_mental_block', no: 'q_distractions' },
            r_mental_block: { type: 'result', diagnosis: 'ØªØ´Ø®ÛŒØµ: Ø¨Ù„ÙˆÚ© Ø°Ù‡Ù†ÛŒ Ù†Ø§Ø´ÛŒ Ø§Ø² ØªØ±Ø³ ÛŒØ§ Ú©Ù…Ø§Ù„â€ŒÚ¯Ø±Ø§ÛŒÛŒ.', solution: 'Ø±Ø§Ù‡Ú©Ø§Ø±: Ù‡Ø¯Ù Ø±Ø§ Ø±ÙˆÛŒ Ø´Ø±ÙˆØ¹ Ú©Ø±Ø¯Ù† Ø¨Ú¯Ø°Ø§Ø±ÛŒØ¯ØŒ Ù†Ù‡ Ø¹Ø§Ù„ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø¯Ø§Ø¯Ù†. Ø§Ø² Ù…Ø±Ø¨ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø²ÛŒØ± ÛŒÚ© Ú¯ÙØªÚ¯ÙˆÛŒ Ø§Ù†Ú¯ÛŒØ²Ø´ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ú©Ù†ÛŒØ¯.', gemini_enabled: true, gemini_type: 'pep_talk' },
            q_distractions: { type: 'question', text: 'Ø¢ÛŒØ§ Ù…Ø­ÛŒØ· Ø§Ø·Ø±Ø§ÙÙ… Ù¾Ø± Ø§Ø² Ø¹ÙˆØ§Ù…Ù„ Ø­ÙˆØ§Ø³â€ŒÙ¾Ø±ØªÛŒ Ø§Ø³ØªØŸ', yes: 'r_bad_env', no: 'r_combo' },
            r_bad_env: { type: 'result', diagnosis: 'ØªØ´Ø®ÛŒØµ: Ù…Ø­ÛŒØ· Ù†Ø§Ù…Ù†Ø§Ø³Ø¨ Ùˆ Ù¾Ø± Ø§Ø² Ù…Ø§Ù†Ø¹.', solution: 'Ø±Ø§Ù‡Ú©Ø§Ø±: Ù…Ø­ÛŒØ· Ú©Ø§Ø± Ø®ÙˆØ¯ Ø±Ø§ Ù…Ù‡Ù†Ø¯Ø³ÛŒ Ú©Ù†ÛŒØ¯. Ø¨Ø²Ø±Ú¯ØªØ±ÛŒÙ† Ø¹Ø§Ù…Ù„ Ø­ÙˆØ§Ø³â€ŒÙ¾Ø±ØªÛŒ Ø±Ø§ Ø¨Ù‡ ØµÙˆØ±Øª ÙÛŒØ²ÛŒÚ©ÛŒ Ø­Ø°Ù ÛŒØ§ Ù…Ø­Ø¯ÙˆØ¯ Ú©Ù†ÛŒØ¯.' },
            r_combo: { type: 'result', diagnosis: 'ØªØ´Ø®ÛŒØµ: ØªØ±Ú©ÛŒØ¨ÛŒ Ø§Ø² Ù…ÙˆØ§Ø±Ø¯ Ø¨Ø§Ù„Ø§ ÛŒØ§ Ù…Ø´Ú©Ù„ÛŒ Ø¹Ù…ÛŒÙ‚â€ŒØªØ±.', solution: 'Ø±Ø§Ù‡Ú©Ø§Ø±: Ù…ÙˆØ¶ÙˆØ¹ Ø±Ø§ Ø¨Ø§ ÛŒÚ© ÙØ±Ø¯ Ù…ÙˆØ±Ø¯ Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¯Ø± Ù…ÛŒØ§Ù† Ø¨Ú¯Ø°Ø§Ø±ÛŒØ¯. Ú¯Ø§Ù‡ÛŒ Ø¨ÛŒØ§Ù† Ú©Ø±Ø¯Ù† Ù…Ø´Ú©Ù„ Ø¨Ø§ ØµØ¯Ø§ÛŒ Ø¨Ù„Ù†Ø¯ØŒ Ø®ÙˆØ¯Ø´ Ù†ÛŒÙ…ÛŒ Ø§Ø² Ø±Ø§Ù‡ Ø­Ù„ Ø§Ø³Øª.' }
        };

        // --- APPLICATION LOGIC ---
        const container = document.getElementById('flowchart-container');
        let currentNodeKey = 'start';
        let geminiApiKey = localStorage.getItem('geminiApiKey') || '';

        // --- API KEY MANAGEMENT ---
        const apiKeyModal = document.getElementById('api-key-modal');
        function toggleApiKeyModal(show) {
            apiKeyModal.style.display = show ? 'flex' : 'none';
        }
        function saveApiKey() {
            const input = document.getElementById('api-key-input');
            if (input.value.trim()) {
                geminiApiKey = input.value.trim();
                localStorage.setItem('geminiApiKey', geminiApiKey);
                alert('Ú©Ù„ÛŒØ¯ API Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.');
                toggleApiKeyModal(false);
                renderNode(currentNodeKey); // Re-render to show Gemini button
            } else {
                alert('Ù„Ø·ÙØ§Ù‹ ÛŒÚ© Ú©Ù„ÛŒØ¯ API Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.');
            }
        }

        // --- GEMINI API CALL FUNCTION ---
        async function callGemini(prompt, gemini_type) {
            if (!geminiApiKey) {
                alert('Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ Ú©Ù„ÛŒØ¯ API Ø®ÙˆØ¯ Ø±Ø§ Ø¯Ø± ØªÙ†Ø¸ÛŒÙ…Ø§Øª ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.');
                toggleApiKeyModal(true);
                return;
            }

            const geminiResultDiv = document.getElementById('gemini-result');
            const geminiButton = document.getElementById('gemini-btn');
            
            geminiButton.disabled = true;
            geminiResultDiv.style.display = 'block';
            geminiResultDiv.innerHTML = 'ğŸ§  Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø¯Ø± Ø­Ø§Ù„ ÙÚ©Ø± Ú©Ø±Ø¯Ù† Ø§Ø³Øª...';

            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${geminiApiKey}`;
            
            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });

                if (!response.ok) throw new Error(`Ø®Ø·Ø§ÛŒ Ø´Ø¨Ú©Ù‡: ${response.status}. Ú©Ù„ÛŒØ¯ API Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.`);
                const result = await response.json();
                
                if (result.candidates && result.candidates[0].content.parts.length > 0) {
                    const generatedText = result.candidates[0].content.parts[0].text;
                    if (gemini_type === 'breakdown') {
                        const steps = generatedText.split('\n').filter(step => step.trim() !== '' && step.trim().match(/^\d+\./)).map(step => step.replace(/^\d+\.\s*/, ''));
                        let checklistHtml = '<ul>';
                        steps.forEach(step => {
                            checklistHtml += `<li><input type="checkbox"><label>${step}</label></li>`;
                        });
                        checklistHtml += '</ul>';
                        geminiResultDiv.innerHTML = checklistHtml;
                    } else {
                        geminiResultDiv.innerText = generatedText;
                    }
                } else {
                    throw new Error('Ù¾Ø§Ø³Ø® Ù…Ø¹ØªØ¨Ø±ÛŒ Ø§Ø² Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ù†Ø´Ø¯. Ù…Ù…Ú©Ù† Ø§Ø³Øª Ù…Ø­ØªÙˆØ§ÛŒ Ø´Ù…Ø§ Ù…Ø³Ø¯ÙˆØ¯ Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯.');
                }
            } catch (error) {
                console.error('Error calling Gemini API:', error);
                geminiResultDiv.innerText = `Ù…ØªØ§Ø³ÙØ§Ù†Ù‡ Ù…Ø´Ú©Ù„ÛŒ Ù¾ÛŒØ´ Ø¢Ù…Ø¯: ${error.message}`;
            } finally {
                geminiButton.disabled = false;
            }
        }
        
        // --- UI RENDERING ---
        function handleGeminiRequest(gemini_type) {
            let prompt = '';
            if (gemini_type === 'breakdown') {
                const task = document.getElementById('input1').value.trim();
                if (!task) { alert('Ù„Ø·ÙØ§Ù‹ ØªØ³Ú© Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.'); return; }
                prompt = `You are an expert project manager. Break down the following task into a clear, numbered list of small, actionable steps. The user's task is: "${task}". Provide the response in Persian.`;
            } else if (gemini_type === 'connect_why') {
                const task = document.getElementById('input1').value.trim();
                const goal = document.getElementById('input2').value.trim();
                if (!task || !goal) { alert('Ù„Ø·ÙØ§Ù‹ Ù‡Ø± Ø¯Ùˆ ÙÛŒÙ„Ø¯ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯.'); return; }
                prompt = `You are a motivational coach. The user is doing a task they find boring: '${task}'. Their larger goal is: '${goal}'. Explain in 2-3 concise points how completing this task helps them achieve their goal. Respond in a supportive tone and in Persian.`;
            } else if (gemini_type === 'pep_talk') {
                prompt = `You are a compassionate mindset coach. The user is feeling a mental block due to fear of failure or perfectionism. Provide a short, powerful pep talk (3-4 sentences) to help them start. Reframe the fear into a positive. Respond in an encouraging tone and in Persian.`;
            }
            callGemini(prompt, gemini_type);
        }

        function renderNode(nodeKey) {
            const node = flowchart[nodeKey];
            let html = '';

            if (node.type === 'question') {
                html = `
                    <h2 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1.5rem;">${node.text}</h2>
                    <div style="display: flex; justify-content: center; gap: 1rem;">
                        <button class="btn btn-yes" onclick="handleAnswer('yes')">Ø¨Ù„Ù‡</button>
                        <button class="btn btn-no" onclick="handleAnswer('no')">Ø®ÛŒØ±</button>
                    </div>
                `;
            } else if (node.type === 'result') {
                let geminiHtml = '';
                if (node.gemini_enabled) {
                    let inputsHtml = '';
                    let buttonText = '';
                    let title = '';
                    if (node.gemini_type === 'breakdown') {
                        title = 'âœ¨ Ú©Ù…Ú© Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø¨Ø±Ø§ÛŒ Ø´Ú©Ø³ØªÙ† ØªØ³Ú©';
                        inputsHtml = '<input type="text" id="input1" class="input-field" placeholder="Ù…Ø«Ø§Ù„: Ù†ÙˆØ´ØªÙ† Ú¯Ø²Ø§Ø±Ø´ ÙØ±ÙˆØ´ Ø³Ù‡ Ù…Ø§Ù‡Ù‡">';
                        buttonText = 'Ø¨Ø±Ø§ÛŒÙ… Ø¨Ù‡ Ù…Ø±Ø§Ø­Ù„ Ú©ÙˆÚ†Ú©â€ŒØªØ± ØªÙ‚Ø³ÛŒÙ… Ú©Ù†';
                    } else if (node.gemini_type === 'connect_why') {
                        title = 'âœ¨ ÛŒØ§ÙØªÙ† Ú†Ø±Ø§ÛŒÛŒ Ùˆ Ø§ÛŒØ¬Ø§Ø¯ Ø§Ù†Ú¯ÛŒØ²Ù‡';
                        inputsHtml = `
                            <input type="text" id="input1" class="input-field" placeholder="Ú©Ø§Ø± Ú©Ø³Ù„â€ŒÚ©Ù†Ù†Ø¯Ù‡: Ù…Ø«Ø§Ù„: ØªÙ…ÛŒØ² Ú©Ø±Ø¯Ù† Ø®Ø§Ù†Ù‡">
                            <input type="text" id="input2" class="input-field" placeholder="Ù‡Ø¯Ù Ø¨Ø²Ø±Ú¯â€ŒØªØ±: Ù…Ø«Ø§Ù„: Ø¯Ø§Ø´ØªÙ† Ø¢Ø±Ø§Ù…Ø´ Ø°Ù‡Ù†ÛŒ">
                        `;
                        buttonText = 'Ø¨Ø±Ø§ÛŒÙ… Ø§Ø±ØªØ¨Ø§Ø·Ø´ Ø±Ø§ ØªÙˆØ¶ÛŒØ­ Ø¨Ø¯Ù‡';
                    } else if (node.gemini_type === 'pep_talk') {
                        title = 'âœ¨ Ø¯Ø±ÛŒØ§ÙØª Ú¯ÙØªÚ¯ÙˆÛŒ Ø§Ù†Ú¯ÛŒØ²Ø´ÛŒ';
                        buttonText = 'Ø¨Ù‡ Ù…Ù† Ø§Ù†Ú¯ÛŒØ²Ù‡ Ø¨Ø¯Ù‡';
                    }
                    geminiHtml = `
                        <div class="gemini-section">
                            <h4 class="gemini-title">${title}</h4>
                            ${inputsHtml}
                            <button id="gemini-btn" class="btn btn-gemini" style="width: 100%;" onclick="handleGeminiRequest('${node.gemini_type}')">${buttonText}</button>
                            <div id="gemini-result" style="display: none;"></div>
                        </div>
                    `;
                }

                html = `
                    <div style="text-align: right;">
                        <div class="result-card diagnosis">
                            <h3 style="font-size: 1.125rem; font-weight: 700; color: #c2410c;">ØªØ´Ø®ÛŒØµ Ù…Ø´Ú©Ù„:</h3>
                            <p>${node.diagnosis}</p>
                        </div>
                        <div class="result-card solution">
                            <h3 style="font-size: 1.125rem; font-weight: 700; color: #15803d;">Ø±Ø§Ù‡Ú©Ø§Ø± Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ:</h3>
                            <p>${node.solution}</p>
                        </div>
                        ${geminiHtml}
                        <div style="text-align: center; padding-top: 1rem;">
                            <button class="btn btn-restart" onclick="restart()">Ø´Ø±ÙˆØ¹ Ù…Ø¬Ø¯Ø¯</button>
                            <button class="btn" style="background-color: #6b7280; color: white;" onclick="toggleApiKeyModal(true)">ØªÙ†Ø¸ÛŒÙ…Ø§Øª API</button>
                        </div>
                    </div>
                `;
            }
            container.innerHTML = html;
        }

        function handleAnswer(answer) {
            const currentNode = flowchart[currentNodeKey];
            const nextNodeKey = currentNode[answer];
            if (nextNodeKey) {
                currentNodeKey = nextNodeKey;
                renderNode(currentNodeKey);
            }
        }

        function restart() {
            currentNodeKey = 'start';
            renderNode(currentNodeKey);
        }

        // Initial render when the page loads
        window.onload = () => {
            renderNode(currentNodeKey);
            if (!geminiApiKey) {
                setTimeout(() => {
                    alert('Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù‚Ø§Ø¨Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ØŒ Ù„Ø·ÙØ§Ù‹ Ú©Ù„ÛŒØ¯ API Ø®ÙˆØ¯ Ø±Ø§ Ø¯Ø± Ø¨Ø®Ø´ Â«ØªÙ†Ø¸ÛŒÙ…Ø§Øª APIÂ» ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.');
                }, 1000);
            }
        };
    </script>
</body>
</html>
